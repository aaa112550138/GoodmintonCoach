<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¸æ‰‹å ±å‘Š</title>
    <!-- å‡è¨­ä½ çš„ CSS æª”æ¡ˆåœ¨ static/style.css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- ç‚ºäº†è®“ç¯„ä¾‹å¥½çœ‹ï¼ŒåŠ ä¸€é»åŸºæœ¬æ¨£å¼ (ä½ å¯ä»¥ç”¨ä½ è‡ªå·±çš„ CSS) -->
    <style>
        body { font-family: system-ui, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 20px auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); padding: 32px; }
        h1, h2 { text-align: center; color: #1d3557; }
        .filters-container { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; }
        .form-group { flex: 1; display: flex; flex-direction: column; min-width: 200px; }
        .form-group.full-width { flex-basis: 100%; }
        label { margin-bottom: 8px; font-weight: 600; color: #495057; }
        input[type="text"], select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            background-color: #007bff; color: white; font-size: 16px; font-weight: 600;
            padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.2s;
        }
        button:hover:not(:disabled) { background-color: #0056b3; }
        button:disabled { background-color: #a0cfff; cursor: not-allowed; }
        
        /* -- é€™æ˜¯æ–°çš„çµæœå€å¡Š -- */
        #analysis-result-area {
            margin-top: 24px; padding: 20px; border: 2px dashed #ced4da;
            border-radius: 8px; min-height: 100px; background-color: #f8f9fa;
        }
        #analysis-result-area.loading {
            display: grid; place-items: center; color: #495057; font-size: 1.1em;
        }
        #analysis-result-area img {
            max-width: 100%; height: auto; margin-top: 16px; border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .error-message {
            color: #d90429; font-weight: bold; white-space: pre-wrap;
        }
        /* ç”¨ pre ä¾†é¡¯ç¤º AI å›è¦†çš„ markdown æ ¼å¼ */
        #analysis-result-area pre {
            white-space: pre-wrap; word-wrap: break-word; background-color: #e9ecef;
            padding: 15px; border-radius: 5px; font-family: Consolas, "Courier New", monospace;
            color: #212529;
        }

        /* -- ä½ åŸæœ‰çš„å ±å‘Šé€£çµæ¨£å¼ -- */
        .match-link-group { margin-top: 10px; }
        .btn-disabled {
            background-color: #6c757d; color: white; padding: 10px 15px;
            border-radius: 5px; text-decoration: none; opacity: 0.65; cursor: not-allowed;
        }
        #report-btn {
            background-color: #28a745; color: white; padding: 10px 15px;
            border-radius: 5px; text-decoration: none; display: inline-block;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ¸ ç¾½çƒæ•™ç·´å„€è¡¨æ¿</h1>

        <!-- 
          ã€é—œéµä¿®æ”¹ 1ã€‘
          - ç§»é™¤ action å’Œ method
          - åŠ ä¸Š id="analysis-form"
        -->
        <form id="analysis-form">
            
            <div class="filters-container">
                <div class="form-group full-width">
                    <label for="search_input">æœå°‹é¸æ‰‹ (å¯é¸)</label>
                    <input type="text" id="search_input" name="search_query" placeholder="è«‹è¼¸å…¥å­¸ç”Ÿå§“å..." value="{{ current_search or '' }}">
                </div>
            </div>

            <div class="filters-container">
                <div class="form-group">
                    <label for="session_select">å ´æ¬¡</label>
                    <select id="session_select" name="session_id">
                        <option value="" {% if not current_session %}selected{% endif %} disabled>-- è«‹é¸æ“‡å ´æ¬¡ --</option>
                        {% for s in sessions %}
                            <option value="{{ s.id }}" {% if s.id == current_session %}selected{% endif %}>
                                {{ s.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="attribute_select">å±¬æ€§</label>
                    <select id="attribute_select" name="attribute_name">
                        <option value="" {% if not current_attribute %}selected{% endif %} disabled>-- è«‹é¸æ“‡å±¬æ€§ --</option>
                        {% for attr in attributes %}
                            <option value="{{ attr }}" {% if attr == current_attribute %}selected{% endif %}>
                                {{ attr }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-group full-width">
                <!-- ã€é—œéµä¿®æ”¹ 2ã€‘åŠ ä¸Š id="generate-button" -->
                <button type="submit" id="generate-button">ç”Ÿæˆåœ–è¡¨</button>
            </div>
        </form>

        <!-- 
          ã€é—œéµä¿®æ”¹ 3ã€‘
          - ç§»é™¤ {% if chart_data %} ... {% endif %}
          - æ›æˆé€™å€‹å›ºå®šçš„ <div>ï¼Œè®“ JavaScript å¡«å…¥å…§å®¹
        -->
        <h2>ğŸ“Š åˆ†æçµæœ</h2>
        <div id="analysis-result-area">
            <p>è«‹é¸æ“‡æ¢ä»¶ä¸¦é»æ“Šã€Œç”Ÿæˆåœ–è¡¨ã€ä»¥é–‹å§‹åˆ†æã€‚</p>
        </div>


        <!-- ğŸ”— æ¯”è³½å ±å‘Šé€£çµï¼ˆç¨ç«‹åŠŸèƒ½ - ä¿æŒä¸è®Šï¼‰-->
        <h2>ğŸ“„ æ¯”è³½å ±å‘Š</h2>
        <div class="filters-container">
            <div class="form-group full-width">
                <label for="match_link_select">é¸æ“‡æ¯”è³½</label>
                <select id="match_link_select" onchange="updateReportLinks()">
                    <option value="" selected disabled>-- è«‹é¸æ“‡æ¯”è³½é€£çµ --</option>
                    {% for link in links %}
                        <option value="{{ url_for(link.route, report_id=link.param) }}">
                            {{ link.name }}
                        </option>
                    {% endfor %}
                </select>
                
            </div>
            <div class="form-group">
                <label>å‰å¾€å ±å‘Š</label>
                <a id="report-btn" href="#" class="btn-disabled" target="_blank">è«‹å…ˆé¸æ“‡æ¯”è³½</a>
            </div>
            <div class="form-group full-width match-link-group">
                <label>é è¦½é¸æ“‡çš„å ±å‘Š</label>
                <a id="actual-link" href="#" target="_blank">è«‹å…ˆé¸æ“‡æ¯”è³½</a>
            </div>
        </div>

    </div>

    <!-- 
      ã€é—œéµä¿®æ”¹ 4ã€‘
      - ä½ çš„ HTML å·²ç¶“æœ‰é€™ä¸€è¡Œäº†ï¼Œä¿æŒä¸è®Šï¼
      - æˆ‘å€‘å°‡åœ¨ä¸‹é¢å»ºç«‹é€™å€‹æª”æ¡ˆã€‚
    -->
    <script src="{{ url_for('static', filename='scripts.js') }}"></script>
</body>
</html>
